# AI Melody Bot ‚Äî –§–∏–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω

## –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è

| –ê—Å–ø–µ–∫—Ç | –†–µ—à–µ–Ω–∏–µ |
|---|---|
| API –¥–æ—Å—Ç—É–ø | Third-party API (Kie.ai / musicapi.ai) |
| –°—Ç–µ–∫ | Python + aiogram 3.x |
| –ë–î | PostgreSQL |
| –•—Ä–∞–Ω–µ–Ω–∏–µ –∞—É–¥–∏–æ | TG native (voice preview ‚Üí audio download) |
| –ó–∞—â–∏—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ | Voice message = –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ. MP3 —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ = –¥–æ–ø. –∫—Ä–µ–¥–∏—Ç |
| –Ø–∑—ã–∫ | –¢–æ–ª—å–∫–æ RU |
| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å | Inline-–∫–Ω–æ–ø–∫–∏ (–±–µ–∑ Web App) |
| –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã | 2 –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |
| –ú–∏–Ω. –ø–∞–∫–µ—Ç | 50 ‚≠ê = 5 –∫—Ä–µ–¥–∏—Ç–æ–≤ |
| –°–ø–∏—Å–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤ | –¢–æ–ª—å–∫–æ –∑–∞ —É—Å–ø–µ—à–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |
| Content policy | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±–∞–Ω –ø–æ—Å–ª–µ 3 –æ—Ç–∫–∞–∑–æ–≤ |
| Retry | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π, –∫—Ä–µ–¥–∏—Ç –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ |
| Rate limiting | –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç/—á–∞—Å + –ª–∏–º–∏—Ç/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å/–¥–µ–Ω—å |
| –°–µ–∫—Ä–µ—Ç—ã | .env |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | Uptime, –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –æ—à–∏–±–∫–∏, –∫—Ä–µ–¥–∏—Ç—ã |

---

## MVP-—Ñ–∏—á–∏

- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é (text prompt)
- ‚úÖ Custom Mode (—Å–≤–æ–π —Ç–µ–∫—Å—Ç/–ª–∏—Ä–∏–∫–∞)
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
- ‚úÖ –í—ã–±–æ—Ä —Å—Ç–∏–ª—è/–∂–∞–Ω—Ä–∞ –≤–æ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–∞—Ö
- ‚úÖ –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞: –º—É–∂—Å–∫–æ–π / –∂–µ–Ω—Å–∫–∏–π (–≤–æ –≤—Å–µ—Ö –≤–æ–∫–∞–ª—å–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö)
- ‚úÖ –û–ø–ª–∞—Ç–∞ Telegram Stars
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–∫–æ–≤
- ‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç-–∑–∞—â–∏—Ç–∞ (voice preview + MP3 –∑–∞ –∫—Ä–µ–¥–∏—Ç)
- ‚úÖ –ê–Ω—Ç–∏—Ñ—Ä–æ–¥ (user_id + cooldown + rate limit + account age)

---

## –ó–∞—â–∏—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

| –≠—Ç–∞–ø | –ß—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|---|---|---|
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è | 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∫–∞–∫ voice message (–Ω–µ–ª—å–∑—è –ª–µ–≥–∫–æ –ø–µ—Ä–µ—Å–ª–∞—Ç—å) | 1 –∫—Ä–µ–¥–∏—Ç |
| –°–∫–∞—á–∏–≤–∞–Ω–∏–µ MP3 | –ü–æ–ª–Ω—ã–π —Ñ–∞–π–ª –∞—É–¥–∏–æ (audio message) | +1 –∫—Ä–µ–¥–∏—Ç –∑–∞ —Ç—Ä–µ–∫ |

---

## –ê–Ω—Ç–∏—Ñ—Ä–æ–¥ (MVP)

- Telegram User ID ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- Cooldown –º–µ–∂–¥—É –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è–º–∏
- Rate limit: max N –≥–µ–Ω–µ—Ä–∞—Ü–∏–π/–¥–µ–Ω—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Account age: –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–∫–∫–∞—É–Ω—Ç –≤ –±–æ—Ç–µ > 24—á

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TB
    subgraph "Telegram"
        U["üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"]
        TG["Telegram Bot API"]
    end
    
    subgraph "–ù–∞—à —Å–µ—Ä–≤–µ—Ä"
        BOT["aiogram Bot"]
        Q["asyncio Queue"]
        DB["PostgreSQL"]
    end
    
    subgraph "–í–Ω–µ—à–Ω–∏–µ"
        API["Kie.ai / musicapi.ai"]
    end
    
    U <-->|"–°–æ–æ–±—â–µ–Ω–∏—è, –∫–Ω–æ–ø–∫–∏, –ø–ª–∞—Ç–µ–∂–∏"| TG
    TG <-->|"Webhook/Polling"| BOT
    BOT --> Q --> API
    API -->|"audio_url"| BOT
    BOT <--> DB
```

### –°—Ö–µ–º–∞ –ë–î

```mermaid
erDiagram
    users {
        bigint telegram_id PK
        varchar username
        int credits
        int free_generations_left
        int content_violations
        boolean is_blocked
        timestamp created_at
        timestamp last_generation_at
    }
    
    generations {
        serial id PK
        bigint user_id FK
        varchar suno_song_id
        varchar prompt
        varchar style
        varchar voice_gender "male|female|none"
        varchar mode "description|custom|instrumental"
        varchar status "pending|processing|complete|error"
        varchar audio_url
        varchar tg_file_id
        boolean mp3_downloaded
        int credits_spent
        timestamp created_at
    }
    
    payments {
        serial id PK
        bigint user_id FK
        varchar tg_payment_id
        int stars_amount
        int credits_purchased
        varchar status
        timestamp created_at
    }
    
    users ||--o{ generations : creates
    users ||--o{ payments : makes
```

---

## UX-—Ñ–ª–æ—É

```mermaid
graph TD
    A["/start"] --> B["–ü—Ä–∏–≤–µ—Ç + 2üíé"]
    B --> MENU{"–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"}
    MENU --> D["üéµ –°–æ–∑–¥–∞—Ç—å"]
    MENU --> E["üë§ –ü—Ä–æ—Ñ–∏–ª—å"]
    MENU --> F["üí∞ –ö—É–ø–∏—Ç—å"]
    MENU --> G["üìö –¢—Ä–µ–∫–∏"]
    MENU --> H["‚ùì –ü–æ–º–æ—â—å"]
    
    D --> CHECK{–ö—Ä–µ–¥–∏—Ç—ã?}
    CHECK -->|–ù–µ—Ç| F
    CHECK -->|–î–∞| MODE
    
    MODE --> D1["üìù –ü–æ –æ–ø–∏—Å–∞–Ω–∏—é"]
    MODE --> D2["üé§ –°–≤–æ–π —Ç–µ–∫—Å—Ç"]
    MODE --> D3["üéπ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª"]
    
    D1 --> GENDER["üöπ/üö∫ –ì–æ–ª–æ—Å"]
    D2 --> LYRICS["–í–≤–æ–¥ –ª–∏—Ä–∏–∫–∏"] --> GENDER
    D3 --> STYLE["–í—ã–±–æ—Ä —Å—Ç–∏–ª—è"]
    GENDER --> STYLE
    
    STYLE --> GEN["‚ö° –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 1-3 –º–∏–Ω"]
    GEN --> RES["üîä 2 voice-–ø—Ä–µ–≤—å—é"]
    
    RES --> DL["üì• –°–∫–∞—á–∞—Ç—å MP3 (‚àí1üíé)"]
    RES --> REGEN["üîÑ –ï—â—ë (‚àí1üíé)"]
    RES --> MENU
```

### –ö–Ω–æ–ø–∫–∏

**–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:**
```
[üéµ –°–æ–∑–¥–∞—Ç—å —Ç—Ä–µ–∫]   [üìö –ú–æ–∏ —Ç—Ä–µ–∫–∏]
[üí∞ –ö—Ä–µ–¥–∏—Ç—ã: Nüíé]   [üë§ –ü—Ä–æ—Ñ–∏–ª—å]
         [‚ùì –ü–æ–º–æ—â—å]
```

**–†–µ–∂–∏–º:**
```
[üìù –ü–æ –æ–ø–∏—Å–∞–Ω–∏—é]
[üé§ –°–≤–æ–π —Ç–µ–∫—Å—Ç]
[üéπ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª]
[‚¨ÖÔ∏è –ù–∞–∑–∞–¥]
```

**–ì–æ–ª–æ—Å (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–æ–∫–∞–ª—å–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤):**
```
[üöπ –ú—É–∂—Å–∫–æ–π]  [üö∫ –ñ–µ–Ω—Å–∫–∏–π]
[‚¨ÖÔ∏è –ù–∞–∑–∞–¥]
```

**–°—Ç–∏–ª–∏:**
```
[üé∏ –†–æ–∫]       [üéπ –ü–æ–ø]     [üé∑ –î–∂–∞–∑]
[üéª –ö–ª–∞—Å—Å–∏–∫–∞]  [üéµ R&B]     [üîä –≠–ª–µ–∫—Ç—Ä–æ]
[üé∂ –•–∏–ø-—Ö–æ–ø]   [üåç World]   [‚úèÔ∏è –°–≤–æ–π]
[‚¨ÖÔ∏è –ù–∞–∑–∞–¥]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
[üîä –í–∞—Ä–∏–∞–Ω—Ç 1]  [üîä –í–∞—Ä–∏–∞–Ω—Ç 2]
[üì• –°–∫–∞—á–∞—Ç—å #1 (‚àí1üíé)]  [üì• –°–∫–∞—á–∞—Ç—å #2 (‚àí1üíé)]
[üîÑ –ï—â—ë –≤–∞—Ä–∏–∞–Ω—Ç—ã (‚àí1üíé)]
[üè† –ú–µ–Ω—é]
```

**–ü–æ–∫—É–ø–∫–∞:**
```
[5üíé ‚Äî ‚≠ê50]
[15üíé ‚Äî ‚≠ê130]
[50üíé ‚Äî ‚≠ê400]
[100üíé ‚Äî ‚≠ê750]
```

---

## –≠–∫–æ–Ω–æ–º–∏–∫–∞

### –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è (Kie.ai): **~$0.06**
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ MP3: **$0** (—É–∂–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ)

### –¶–µ–Ω—ã

| –ü–∞–∫–µ—Ç | ‚≠ê | –î–æ—Ö–æ–¥ ($) | –ö—Ä–µ–¥–∏—Ç–æ–≤ | –ú–∞—Ä–∂–∞ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è) |
|---|---|---|---|---|
| –°—Ç–∞—Ä—Ç–æ–≤—ã–π | 50 | $0.65 | 5 | ~54% |
| –°—Ä–µ–¥–Ω–∏–π | 130 | $1.69 | 15 | ~47% |
| –ë–æ–ª—å—à–æ–π | 400 | $5.20 | 50 | ~42% |
| –ú–∞–∫—Å–∏–º—É–º | 750 | $9.75 | 100 | ~38% |

> [!NOTE]
> –°–∫–∞—á–∏–≤–∞–Ω–∏–µ MP3 = —á–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å (–∫–æ–Ω—Ç–µ–Ω—Ç —É–∂–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω). –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –º–∞—Ä–∂—É.

### Disclaimer
*"–ú—É–∑—ã–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ò–ò. –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ —É—Å–ª–æ–≤–∏—è–º–∏ Suno AI."*
